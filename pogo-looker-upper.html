<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>Pokemon GO: Strength looker-upper</title>

    <style>
     .overflowed {
	   width: 20em;
	   height: 2em;
	   white-space: nowrap; 
	   overflow: hidden;

     }

     .overflowed-clip {
	   text-overflow: clip;
     }

     .overflowed-ellipsis {
	   text-overflow: ellipsis;
     }

     .overflowed-ellipsis-word  {
	   text-overflow: ellipsis-word;
     }
    </style>
    <script>
     /*
        The pokemon types and their weaknesses
      */
     const matrix  = {
       "normal"   : ["fighting"],
       "fighting" : ["flying","psychic","fairy"],
       "flying"   : ["rock","electric","ice"],
       "poison"   : ["ground","psychic"],
       "ground"   : ["water","grass","ice"],
       "rock"     : ["fighting","ground","steel","water","grass"],
       "bug"      : ["flying","rock","fire"],
       "ghost"    : ["ghost","dark"],
       "steel"    : ["fighting","ground","fire"],
       "fire"     : ["ground","rock","water"],
       "water"    : ["grass","electric"],
       "grass"    : ["flying","poison","bug","fire","ice"],
       "electric" : ["ground"],
       "psychic"  : ["bug","ghost","dark"],
       "ice"      : ["fighting","rock","steel","fire"],
       "dragon"   : ["ice","dragon","fairy"],
       "fairy"    : ["poison","steel"],
       "dark"     : ["fighting","bug","fairy"],

     };

     /*
        Helper function.
        Capitalises the first letter of a string.
      */
     function _uc (string) {
       return string.charAt(0).toUpperCase() + string.slice(1);
     }

     /*
        Given two types, returns pokemon type which will give 4x fighting
        strength. returns undef if it doesnt exist.
      */
     function getUltimateType (prim, seco) {
       const primArr = matrix[prim];
       const secoArr = matrix[seco];

       // filter() passes each element of primArr to a lambda.
       // If function returns false, said element is filtered away
       return  primArr.filter(
         // The fat arrow's the lambda, which takes one param known here as 'value'.
         value =>

           // includes() returns true if value exists
           // in the array.
           secoArr.includes(value));
     }

     /*
        Given an array of poketypes, returns a string you
        can paste into Pokemon GO's Pokemon search field.
      */
     function createSearchString (pokeArray) {
       var output = "";
       var arr = [];

       if (pokeArray.length === 0) {
         return "";
       }

       for (var t in pokeArray) {
         arr.push("@" + 1 + pokeArray[t]);
       }
       output = arr.join(',');

       arr = [];
       for (var t in pokeArray) {
         arr.push("@" + 2 + pokeArray[t]);
       }
       output += "&" + arr.join(',');

       return output;
     }


     /*
        Updates HTML entities for secondary poketype with data
      */
     function refresh () {
       var prim = document.getElementById("primaryType").innerHTML;
       var seco = document.getElementById("secondaryType").innerHTML;

       document.getElementById("primaryType2").innerHTML = _uc(prim);
       document.getElementById("secondaryType2").innerHTML = _uc(seco);


       if ("-" !== prim) {
         document.getElementById("primaryWeakness").innerHTML = matrix[prim];
         document.getElementById("primarySearch").value = createSearchString(matrix[prim]);
       } else {
         document.getElementById("primaryWeakness").innerHTML = "-";
         document.getElementById("primarySearch").value = "-";
       }
       if ("-" !== seco) {
         document.getElementById("secondaryWeakness").innerHTML = matrix[seco];
         document.getElementById("secondarySearch").value = createSearchString(matrix[seco]);
       } else {
         document.getElementById("secondaryWeakness").innerHTML = "-";
         document.getElementById("secondarySearch").value = "-";
       }
       if ("-" !== prim && "-" !== seco) {
         var types = getUltimateType(prim, seco);
         document.getElementById("ultimateType").innerHTML = types;
         document.getElementById("ultimateSearch").value = createSearchString(types);
       } else {
         document.getElementById("ultimateType").innerHTML = "-";
         document.getElementById("ultimateSearch").value = "-";
       }
     }

     /*
        Save primary type
      */
     function updatePrimary (poketype) {
       document.getElementById("primaryType").innerHTML = poketype;
       refresh();
     }
     /*
        Save secondary type
      */
     function updateSecondary (poketype) {
       document.getElementById("secondaryType").innerHTML = poketype;
       refresh();
     }

     /*
        Resets everything to initial state
      */
     function reset () {
       document.getElementById("primaryType").innerHTML = "-";
       document.getElementById("secondaryType").innerHTML = "-";
       document.getElementById("p_none").checked = true;
       document.getElementById("s_none").checked = true;

       refresh();
     }

     function copyPrim() {
       var copyText = document.getElementById("primarySearch");
       copyText.select();
       copyText.setSelectionRange(0, 99999); /*For mobile devices*/
       document.execCommand("copy");
       //       alert("Copied the text: " + copyText.value);
     }
     function copySeco() {
       var copyText = document.getElementById("secondarySearch");
       copyText.select();
       copyText.setSelectionRange(0, 99999); /*For mobile devices*/
       document.execCommand("copy");
       //       alert("Copied the text: " + copyText.value);
     }
     function copyUlti() {
       var copyText = document.getElementById("ultimateSearch");
       copyText.select();
       copyText.setSelectionRange(0, 99999); /*For mobile devices*/
       document.execCommand("copy");
       //       alert("Copied the text: " + copyText.value);
     }

    </script>
  </head>
  <body>
    <center><h1>Pokemon GO:<br/>Looker upper</h1></center>
    <div id="foo"></div>

    <table border="1" width="100%">

      <tr>
        <td width="50%" bgcolor="#88cc88">
          <h2>Primary type:</h2>
          <input type="radio" name="f" id="p_none" onclick=updatePrimary("-") checked>Nothing selected</input><br/>

          <input type="radio" name="f" onclick=updatePrimary("bug")      >Bug</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("dark")     >Dark</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("dragon")   >Dragon</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("electric") >Electric</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("fairy")    >Fairy</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("fighting") >Fighting</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("fire")     >Fire</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("flying")   >Flying</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("ghost")    >Ghost</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("grass")    >Grass</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("ground")   >Ground</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("ice")      >Ice</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("normal")   >Normal</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("poison")   >Poison</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("psychic")  >Psychic</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("rock")     >Rock</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("steel")    >Steel</input><br/>
          <input type="radio" name="f" onclick=updatePrimary("water")    >Water</input><br/>

          <p>
            <span id="primaryType2">-</span> is weak against:
            <b id="primaryWeakness">-</b>
          </p>
          Search string to fight <b id="primaryType">-</b> type:
          <input type="text" class="overflowed overflowed-ellipsis" id="primarySearch" value="-"></div>
          <button onclick=copyPrim()>Copy</button>

        </td>
        <td width="50%" bgcolor="#8888cc">
          <h2>Secondary type (optional):</h2>
          <input type="radio" name="g" id="s_none" onclick=updateSecondary("-") checked>Nothing selected</input><br/>

          <input type="radio" name="g" onclick=updateSecondary("bug")      >Bug</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("dark")     >Dark</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("dragon")   >Dragon</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("electric") >Electric</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("fairy")    >Fairy</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("fighting") >Fighting</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("fire")     >Fire</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("flying")   >Flying</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("ghost")    >Ghost</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("grass")    >Grass</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("ground")   >Ground</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("ice")      >Ice</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("normal")   >Normal</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("poison")   >Poison</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("psychic")  >Psychic</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("rock")     >Rock</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("steel")    >Steel</input><br/>
          <input type="radio" name="g" onclick=updateSecondary("water")    >Water</input><br/>


          <p>
            <span id="secondaryType2">-</span> is weak against:
            <b id="secondaryWeakness">-</b>
          </p>
          Search string to fight <b id="secondaryType">-</b> type:
          <input type="text" class="overflowed overflowed-ellipsis" id="secondarySearch" value="-"></input>
          <button onclick=copySeco()>Copy</button>
        </td>
      </tr>

      <tr>
        <td colspan="2" height="70" valign="top" bgcolor="#cc8888">
          The ultimate pokemon attack(s) against these two poketypes are: <b id="ultimateType">-</b>.<br/>

          Your ultimate search string is:
          <input type="text" class="overflowed overflowed-ellipsis" id="ultimateSearch" value="-"></input>
          <button onclick=copyUlti()>Copy</button>
        </td>
      </tr>
    </table>
    <p>
      <center>
        <button type="button" onclick="reset()">Reset!</button>
      </center>
    </p>
  </body>
</html>
