<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <!--
       So... when playing Pokemon GO, there's this situation which
       comes up every now and then - you're about to fight some
       pokemon, and you see it's a WATER type. The app suggests a
       team for you to enter the fray with, but often it's not a very
       strong team because it doesn't take the defender's weaknesses
       into consideration.

       What I normally do then is to google the defender's type, get
       to a web page with a zillion ads, scroll down lots and lots where I may or may not find a
       table where I look up the type. If it was type WATER, I find
       out that this pokemon is weak to Fire, Ground, and Rock
       attacks.

       Next, I re-open Pokemon GO, and search among my Pokemon for
       any which has moves which belong to one of he three
       attacks. PoGo has a weird search syntax, and I need to type
       the following:

       @1fire,@1ground,@1rock&@2fire,@2ground,@2rock

       This is, needless to say, a major PITA.

       So I decided to write a little webpage which does the lookup
       for me. Along the way I even learned some (very basic)
       javascript. Yay for me!

       fimblo
  -->

  <head>
    <title>Pokemon GO: Strength looker-upper</title>

    <script>
     /*
        The pokemon types and their weaknesses
      */
     const matrix  = {
       "normal"   : ["fighting"],
       "fighting" : ["flying","psychic","fairy"],
       "flying"   : ["rock","electric","ice"],
       "poison"   : ["ground","psychic"],
       "ground"   : ["water","grass","ice"],
       "rock"     : ["fighting","ground","steel","water","grass"],
       "bug"      : ["flying","rock","fire"],
       "ghost"    : ["ghost","dark"],
       "steel"    : ["fighting","ground","fire"],
       "fire"     : ["ground","rock","water"],
       "water"    : ["grass","electric"],
       "grass"    : ["flying","poison","bug","fire","ice"],
       "electric" : ["ground"],
       "psychic"  : ["bug","ghost","dark"],
       "ice"      : ["fighting","rock","steel","fire"],
       "dragon"   : ["ice","dragon","fairy"],
       "fairy"    : ["poison","steel"],
       "dark"     : ["fighting","bug","fairy"],

     };


     /*
        Given two types, returns pokemon type which will give 4x fighting
        strength. returns undef if it doesnt exist.
      */
     function getUltimateType (prim, seco) {
       const primArr = matrix[prim];
       const secoArr = matrix[seco];
       var ultimateArr = [];

       for (var p in primArr) {
         for (var s in secoArr) {
           if (primArr[p] === secoArr[s]) {
             ultimateArr.push(primArr[p]);
           }
         }
       }
       return ultimateArr;
     }

     /*
        Given an array of poketypes, returns a string you
        can paste into Pokemon GO's Pokemon search field.
      */
     function createSearchString (pokeArray) {
       var output = "";
       var arr = [];

       if (pokeArray.length === 0) {
         return "";
       }
       
       for (var t in pokeArray) {
         arr.push("@" + 1 + pokeArray[t]);
       }
       output = arr.join(',');

       arr = [];
       for (var t in pokeArray) {
         arr.push("@" + 2 + pokeArray[t]);
       }
       output += "&" + arr.join(',');

       return output;
     }

     
     /*
        Updates HTML entities for secondary poketype with data
      */
     function refresh () {
       var prim = document.getElementById("primaryType").innerHTML;
       var seco = document.getElementById("secondaryType").innerHTML;

       
       
       if ("-" !== prim) {
         document.getElementById("primaryWeakness").innerHTML = matrix[prim];
         document.getElementById("primarySearch").innerHTML = createSearchString(matrix[prim]);
       } else {
         document.getElementById("primaryWeakness").innerHTML = "-";
         document.getElementById("primarySearch").innerHTML = "-";
       }
       if ("-" !== seco) {
         document.getElementById("secondaryWeakness").innerHTML = matrix[seco];
         document.getElementById("secondarySearch").innerHTML = createSearchString(matrix[seco]);
       } else {
         document.getElementById("secondaryWeakness").innerHTML = "-";
         document.getElementById("secondarySearch").innerHTML = "-";
       }
       if ("-" !== prim && "-" !== seco) {
         var types = getUltimateType(prim, seco);
         document.getElementById("ultimateType").innerHTML = types;
         document.getElementById("ultimateSearch").innerHTML = createSearchString(types);
       } else {
         document.getElementById("ultimateType").innerHTML = "-";
         document.getElementById("ultimateSearch").innerHTML = "-";
       }
     }

     /*
        Save primary type
      */
     function updatePrimary (poketype) {
       document.getElementById("primaryType").innerHTML = poketype;
       refresh();
     }
     /*
        Save secondary type
      */
     function updateSecondary (poketype) {
       document.getElementById("secondaryType").innerHTML = poketype;
       refresh();
     }

     /* 
        Resets everything to initial state
      */
     function reset () {
       document.getElementById("primaryType").innerHTML = "-";
       document.getElementById("secondaryType").innerHTML = "-";
       refresh();
     }

    </script>
  </head>
  <body>
    <div id="foo"></div>
    <p>
      <button type="button" onclick="reset()">Reset!</button>
    </p>

    
    Your opponent Pokemon is type: <b id="primaryType">-</b>.<br/>
    It is weak against: <b id="primaryWeakness">-</b>.<br/>

    <p>
      Your search string is:
      <div id="primarySearch"></div>
    </p>

    <p>
      <button type="button" onclick=updatePrimary("bug")      >Bug</button>
      <button type="button" onclick=updatePrimary("dark")     >Dark</button>
      <button type="button" onclick=updatePrimary("dragon")   >Dragon</button>
      <button type="button" onclick=updatePrimary("electric") >Electric</button>
      <button type="button" onclick=updatePrimary("fairy")    >Fairy</button>
      <button type="button" onclick=updatePrimary("fighting") >Fighting</button>
    </p>
    <p>
      <button type="button" onclick=updatePrimary("fire")     >Fire</button>
      <button type="button" onclick=updatePrimary("flying")   >Flying</button>
      <button type="button" onclick=updatePrimary("ghost")    >Ghost</button>
      <button type="button" onclick=updatePrimary("grass")    >Grass</button>
      <button type="button" onclick=updatePrimary("ground")   >Ground</button>
      <button type="button" onclick=updatePrimary("ice")      >Ice</button>
    </p>
    <p>
      <button type="button" onclick=updatePrimary("normal")   >Normal</button>
      <button type="button" onclick=updatePrimary("poison")   >Poison</button>
      <button type="button" onclick=updatePrimary("psychic")  >Psychic</button>
      <button type="button" onclick=updatePrimary("rock")     >Rock</button>
      <button type="button" onclick=updatePrimary("steel")    >Steel</button>
      <button type="button" onclick=updatePrimary("water")    >Water</button>
    </p>

    <hr/>
    Does your opponent have a second type? Select secondary type here:<br/>

    <p>
      <button type="button" onclick=updateSecondary("bug")      >Bug</button>
      <button type="button" onclick=updateSecondary("dark")     >Dark</button>
      <button type="button" onclick=updateSecondary("dragon")   >Dragon</button>
      <button type="button" onclick=updateSecondary("electric") >Electric</button>
      <button type="button" onclick=updateSecondary("fairy")    >Fairy</button>
      <button type="button" onclick=updateSecondary("fighting") >Fighting</button>
    </p>
    <p>
      <button type="button" onclick=updateSecondary("fire")     >Fire</button>
      <button type="button" onclick=updateSecondary("flying")   >Flying</button>
      <button type="button" onclick=updateSecondary("ghost")    >Ghost</button>
      <button type="button" onclick=updateSecondary("grass")    >Grass</button>
      <button type="button" onclick=updateSecondary("ground")   >Ground</button>
      <button type="button" onclick=updateSecondary("ice")      >Ice</button>
    </p>
    <p>
      <button type="button" onclick=updateSecondary("normal")   >Normal</button>
      <button type="button" onclick=updateSecondary("poison")   >Poison</button>
      <button type="button" onclick=updateSecondary("psychic")  >Psychic</button>
      <button type="button" onclick=updateSecondary("rock")     >Rock</button>
      <button type="button" onclick=updateSecondary("steel")    >Steel</button>
      <button type="button" onclick=updateSecondary("water")    >Water</button>
</p>

<p>
  Selected secondary type: <b id='secondaryType'>-</b>.<br/>
  It is weak against: <b id='secondaryWeakness'>-</b>.<br/>
</p>

<p>
  Your new search string is:
  <div id="secondarySearch"></div>
</p>

<hr/>
The ultimate pokemon attack(s) against these two poketypes are: <span id="ultimateType">-</span>.<br/>
<p>
  Your ultimate search string is:
  <div id="ultimateSearch"></div>
</p>

</body>
</html>
